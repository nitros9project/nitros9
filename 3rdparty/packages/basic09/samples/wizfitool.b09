PROCEDURE wizfitool(* * WizFi360 Tool **)(* * By: Matt Massie*)RUN foenix("Clear")PRINT "Loading..." \ PRINT "Comminicating with WizFi360"SHELL "xmode /wz eko=0 alf=1"DIM res:STRING[255]DIM res_mod:STRING[255]DIM res_pos,res_pos2:INTEGERDIM wz_path,file_path:BYTEDIM name:STRING[4]DIM commnd:STRINGDIM x,y,btn,bm,choice,key:INTEGERDIM wmode:INTEGER \wmode=0DIM ip,gt,nm:STRINGname="/wz"DIM hostname:STRING[255]DIM ssid,pass:STRINGOPEN #wz_path,name:UPDATEPRINT #wz_path,"AT"4 READ #wz_path,resIF LEN(res)>1 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 5IF MID$(res,2,5)="ERROR" THEN 4GOTO 45 PRINT #wz_path,"ATE1"6 READ #wz_path,resIF LEN(res)>1 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 7GOTO 67 CLOSE #wz_pathRUN foenix("CurOff")RUN foenix("Bitmap",0,0,bm,0,0,"/DD/SYS/BACKGROUNDS/CLUTWIZFI")RUN foenix("BMLoad",bm,"/DD/SYS/BACKGROUNDS/PIXMAPWIZFI")RUN foenix("Gon")RUN foenix("Clear")10 RUN foenix("CurXY",0,6)PRINT "NitrOS-9 F256 WizFi360"PRINT ""GOSUB 110015 RUN foenix("CurXY",0,19)PRINT "0 List APs | 1 WWW Ping | 2 Remote Login | 3 WizFi DW  | 4 WizFi Details"PRINT "5 Connect to AP | 6 Ping host | 7 Firmware Ver | 8 OTA Firmware Update"PRINT "9 Quit Tool| A Disconnect | B DHCP/Static | C Save Net File  | D Shell    "PRINT "E Reset WizFi360 | F Send AT cmd"PRINT ""PRINT " Choice (0-F) or use Mouse "20 choice=0 \btn=0RUN foenix("Mouse",x,y,btn) \RUN foenix("CurXY",0,28) \ PRINT "X: "
; x; " Y: "; y; "       "; RUN foenix("Inkey",choice)IF choice=48 THEN 200IF choice=49 THEN 300IF choice=50 THEN 400IF choice=51 THEN 700IF choice=52 THEN 150IF choice=53 THEN 900IF choice=55 THEN 600IF choice=54 THEN 800IF choice=56 THEN 1000IF choice=57 THEN 100IF choice=97 OR choice=65 THEN 1200IF choice=98 OR choice=66 THEN 1300IF choice=99 OR choice=67 THEN 1400IF choice=100 OR choice=68 THEN 1500IF choice=101 OR choice=69 THEN 1600IF choice=102 OR choice=70 THEN 1700IF y>=152 AND y<=158 THEN 30IF y>=160 AND y<=167 THEN 40IF y>=168 AND y<=176 THEN 50IF y>=177 AND y<=182 THEN 60FOR t=1 TO 50 \NEXT tGOTO 2030 IF x>=0 AND x<=45 AND btn<>0 THEN 200IF x>=46 AND x<=96 AND btn<>0 THEN 300IF x>=98 AND x<=164 AND btn<>0 THEN 400IF x>=166 AND x<=220 AND btn<>0 THEN 700IF x>=222 AND x<=288 AND btn<>0 THEN 150GOTO 2040 IF x>=0 AND x<=45 AND btn<>0 THEN 900IF x>=66 AND x<=121 AND btn<>0 THEN 800IF x>=122 AND x<=188 AND btn<>0 THEN 600IF x>=191 AND x<=281 AND btn<>0 THEN 1000GOTO 2050 IF x>=0 AND x<=45 AND btn<>0 THEN 100IF x>=47 AND x<=101 AND btn<>0 THEN 1200IF x>=106 AND x<=169 AND btn<>0 THEN 1300IF x>=170 AND x<=244 AND btn<>0 THEN 1400IF x>=246 AND x<=300 AND btn<>0 THEN 1500GOTO 2060 IF x>=0 AND x<=65 AND btn<>0 THEN 1600IF x>=70 AND x<=130 AND btn<>0 THEN 1700GOTO 20100 RUN foenix("BMOff",0)RUN foenix("Goff")RUN foenix("CurOn")IF wmode=0 THEN RUN foenix("Clear")ENDIF END 150 RUN foenix("Clear") \RUN foenix("CurXY",0,6)OPEN #wz_path,name:UPDATEPRINT #wz_path,"AT+CIPAPMAC?"152 READ #wz_path,resIF LEN(res)>3 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 154GOTO 152154 PRINT #wz_path,"AT+CIPMODE?"156 READ #wz_path,resIF LEN(res)>3 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 158GOTO 156158 PRINT #wz_path,"AT+CIPMUX?"160 READ #wz_path,resIF LEN(res)>3 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 162GOTO 160162 SHELL "sleep 90"PRINT #wz_path,"AT+CIPSERVERMAXCONN?"SHELL "sleep 20"164 READ #wz_path,resIF LEN(res)>3 THEN PRINT resENDIF IF MID$(res,2,2)="OK" THEN 166GOTO 164166 CLOSE #wz_pathGOSUB 500RUN foenix("Clear") \ GOTO 10200 RUN foenix("Clear") \RUN foenix("CurXY",0,6)OPEN #wz_path,name:UPDATEcommnd="AT+CWLAP"PRINT #wz_path,commnd201 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 240IF MID$(res,2,5)="ERROR" THEN 240GOTO 201240 CLOSE #wz_path \ GOSUB 500RUN foenix("Clear") \ GOTO 10300 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Pinging google.com"hostname="google.com"GOTO 801400 RUN foenix("Clear") \RUN foenix("CurXY",0,6)SHELL "/DD/SCRIPTS/WIZSERVER"SHELL "/DD/SCRIPTS/WIZMON"SHELL "/DD/SCRIPTS/WIZLOGIN"410 PRINT ""wmode=1PRINT "The WizFi Adapter has entered Tranparent Mode"PRINT "Only remote shell will work until reset"GOTO 100RUN foenix("Clear") \ GOTO 10500 key=0 \btn=0PRINT ""PRINT "Press Any Key or Click to Continue"501 RUN foenix("Inkey",key)RUN foenix("Mouse",x,y,btn)IF key<>0 OR btn<>0 THEN RETURN ELSE GOTO 501ENDIF 600 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "WizFi360 Firmware Version" \ PRINT ""commnd="AT+GMR"OPEN #wz_path,name:UPDATEPRINT #wz_path,commnd601 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 602GOTO 601602 CLOSE #wz_pathGOSUB 500RUN foenix("Clear") \ GOTO 10700 RUN foenix("Clear") \RUN foenix("CurXY",0,6)SHELL "/DD/SCRIPTS/WIZSERVER"SHELL "/DD/SCRIPTS/WIZMON"wmode=1GOTO 410800 RUN foenix("Clear") \RUN foenix("CurXY",0,6)RUN foenix("CurOn")INPUT "Hostname/IP to Ping ",hostnameRUN foenix("CurOff")801 commnd="AT+PING="OPEN #wz_path,name:UPDATEPRINT #wz_path,commnd+CHR$(34)+hostname+CHR$(34)SHELL "sleep 20"805 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 810IF MID$(res,2,5)="ERROR" THEN 810GOTO 805SHELL "sleep 20"810 PRINT #wz_path,commnd+CHR$(34)+hostname+CHR$(34)811 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 820IF MID$(res,2,5)="ERROR" THEN 820GOTO 811820 CLOSE #wz_pathGOSUB 500RUN foenix("Clear") \ GOTO 10900 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Enter AP Information" \ PRINT ""RUN foenix("CurON")INPUT "SSID: ",ssidINPUT "Passphrase: ",passRUN foenix("CurOff")commnd="AT+CWJAP="OPEN #wz_path,name:UPDATEPRINT #wz_path,commnd+CHR$(34)+ssid+CHR$(34)+CHR$(44)+CHR$(34)+pass
+CHR$(34)910 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 920GOTO 910920 CLOSE #wz_path \ GOSUB 500RUN foenix("Clear") \ GOTO 101000 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "** WARNING UPDATING FIRMWARE **"PRINT "** THIS IS A DANGEROUS PROCESS*"PRINT ""INPUT "Type YES <enter> to proceed ",passIF pass="YES" THEN choice=0 \ PRINT " 1 WWW Upgrade | 2 Local HTTP Server | 3 Abort"INPUT "Choice (1-3): ",choicePRINT "This process takes minutes to complete"IF choice=1 THEN OPEN #wz_path,name:UPDATEcommnd="AT+CIUPDATE="PRINT #wz_path,commnd+CHR$(34)+"http://github.com/wizfi/Release/raw/refs/heads/master/Binary/1.1.2.0/WizFi360_SDK.img"
+CHR$(34)ENDIF IF choice=2 THEN OPEN #wz_path,name:UPDATEINPUT "Hostname (http://192.168.1.10/WizFi360_SDK.img): ",hostnamecommnd="AT+CIUPDATE="PRINT #wz_path,commnd+CHR$(34)+hostname+CHR$(34)ENDIF IF choice<>1 AND choice<>2 THEN PRINT "Choice 1 or 2 - Aborted Upgrade"GOSUB 500RUN foenix("Clear") \ GOTO 10ENDIF 1010 READ #wz_path,resPRINT resIF MID$(res,2,5)="ready" THEN 1020GOTO 1010ELSE PRINT "You MUST type YES to accept Warning"ENDIF GOSUB 500RUN foenix("Clear") \ GOTO 101020 CLOSE #wz_path \ PRINT "Firmware update returned 'ready'"GOSUB 500RUN foenix("Clear") \ GOTO 101100 OPEN #wz_path,name:UPDATEcommnd="AT+CWHOSTNAME?"PRINT #wz_path,commnd1101 READ #wz_path,resREAD #wz_path,resPRINT resREAD #wz_path,resREAD #wz_path,resIF MID$(res,2,2)="OK" THEN 11021102 commnd="AT+CIPSTA_CUR?"PRINT #wz_path,commndSHELL "sleep 120"1103 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1104GOTO 11031104 CLOSE #wz_path \ RETURN 1200 RUN foenix("Clear") \RUN foenix("CurXY",0,6)OPEN #wz_path,name:UPDATEcommnd="AT+CWQAP"PRINT #wz_path,commnd1201 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1202GOTO 12011202 READ #wz_path,resPRINT resCLOSE #wz_pathSHELL "sleep 60"GOSUB 500RUN foenix("Clear") \ GOTO 101300 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Would you like to configure"PRINT "1 DHCP   | 2 STATIC  | 3 Cancel"choice=01301 RUN foenix("Inkey",choice)IF choice=49 THEN 1310IF choice=50 THEN 1320IF choice=51 THEN 1351GOTO 13011310 PRINT "DHCP"OPEN #wz_path,name:UPDATEcommnd="AT+CWDHCP=1,1"PRINT #wz_path,commnd1311 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1350GOTO 1311GOTO 13501320 PRINT "STATIC"RUN foenix("CurOn")INPUT "IP Address: ",ipINPUT "Gateway:    ",gtINPUT "NetMask:    ",nmRUN foenix("CurOff")OPEN #wz_path,name:UPDATEcommnd="AT+CWDHCP=1,0"PRINT #wz_path,commnd1321 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1322GOTO 13211322 commnd="AT+CIPSTA_CUR="PRINT #wz_path,commnd+CHR$(34)+ip+CHR$(34)+CHR$(44)+CHR$(34)+gt+
CHR$(34)+CHR$(44)+CHR$(34)+nm+CHR$(34)1323 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1350GOTO 1323GOTO 13501350 CLOSE #wz_path1351 GOSUB 500 \RUN foenix("Clear") \ GOTO 101400 RUN foenix("Clear") \RUN foenix("CurXY",0,6)RUN foenix("CurOn")INPUT "Enter Filename to Save: ",passRUN foenix("CurOff")OPEN #wz_path,name:UPDATECREATE #file_path,pass:WRITEcommnd="AT+CIPMODE=0"PRINT #wz_path,commnd1401 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1402GOTO 14011402 commnd="AT+CIPMUX=1"PRINT #wz_path,commnd1403 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1404GOTO 14031404 commnd="AT+CIPSERVERMAXCONN=1"PRINT #wz_path,commnd1405 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1406GOTO 14051406 commnd="AT+CIPSERVER=1,22"PRINT #wz_path,commndSHELL "sleep 60"1407 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1408GOTO 14071408 PRINT "Connect to Port 22 now"1409 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1410IF MID$(res,2,12)="0,CONNECT" THEN 1410GOTO 14091410 PRINT "Type DONE to quit" \ PRINT "Receiving File"1411 READ #wz_path,resres_mod=""IF SUBSTR("+IPD",res)>0 THEN res_pos=SUBSTR(":",res)IF res_pos>0 THEN res_mod=MID$(res,res_pos+1,LEN(res)-res_pos-1)+CHR$(13)ELSE PRINT "skip"ENDIF ENDIF res_pos2=0PRINT resres_pos2=SUBSTR("0,CLOSED",res)IF res_pos2>0 THEN res_mod=MID$(res,res_pos+1,LEN(res)-res_pos-9)PRINT #file_path,res_modENDIF IF res_pos2>0 THEN 1412PRINT #file_path,res_mod; IF MID$(res,2,13)="+IPD,0,6:DONE" THEN 1412IF MID$(res,2,5)="ERROR" THEN 1412SHELL "sleep 10"GOTO 14111412 PRINT "Close your telnet session now to return to normal mode"PRINT "File Saved"1414 CLOSE #wz_pathCLOSE #file_pathGOSUB 500 \RUN foenix("Clear") \ GOTO 101500 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Interactive Shell"PRINT "ECHO AT>/wz   to send commands"PRINT "dump /wz      to view command result CNTL-C to exit"PRINT "Type 'ex' to return to WizFi Tool. Erase the '.' before typing ex"SHELL "shell"GOSUB 500RUN foenix("Clear") \ GOTO 101600 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Reseting WizFi360"OPEN #wz_path,name:UPDATEcommnd="AT+RST"PRINT #wz_path,commnd1610 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1620GOTO 16101620 READ #wz_path,resPRINT resIF MID$(res,2,5)="ready" THEN 1630GOTO 16201630 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1640GOTO 16301640 CLOSE #wz_pathGOSUB 500RUN foenix("Clear") \ GOTO 101700 RUN foenix("Clear") \RUN foenix("CurXY",0,6)PRINT "Send AT command to WizFi360"OPEN #wz_path,name:UPDATEPRINT #wz_path,"AT"1710 READ #wz_path,resPRINT resIF MID$(res,2,2)="OK" THEN 1720GOTO 17101720 SHELL "sleep 30"GOSUB 500RUN foenix("Clear") \ GOTO 10